!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).NEUX={})}(this,(function(t){"use strict";let e;function n(t,n){if(e)throw Error("Collision in state binding");const o=e=new Map,c=t();e=null;for(const t of o){const[e,o]=t;for(const t in o)n(e,t,o[t])}return c}function o(t,n,o){if(!e)return;const c=e.get(t)||{};c[n]=o||null,e.set(t,c)}class c{#t={};on(t,e){if(t&&e){const n=this.#t,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!1)}}once(t,e){if(t&&e){const n=this.#t,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!0)}}off(t,e){if(t){const n=this.#t,o=[].concat(t);for(const t of o)n[t]&&(e?(n[t].delete(e),n[t].size||delete n[t]):(n[t].clear(),delete n[t]))}}emit(t,...e){const n=this.#t;if("*"===t)for(const t in n)for(const[o,c]of n[t])o(...e),c&&this.off(t,o);else{const o=new Set([].concat(t));for(const t of o)if(n[t])for(const[o,c]of n[t])o(...e),c&&this.off(t,o)}}}function r(t){return void 0===t}function i(t){return"function"==typeof t}function s(t){return"string"==typeof t}function f(t){return Array.isArray(t)}function a(t){return"object"==typeof t&&null!==t&&(t.constructor===Object||t.constructor===Array)}function l(t,e){return a(t)&&Object.prototype.hasOwnProperty.call(t,e)}const u=Symbol("isProxy");function d(t){if(r(t)&&(t={}),t[u]||!a(t))return t;const e=/^\$/,n=new c,$=new c,m=new c,y=new Proxy(t,{get:(t,c,r)=>c===u||("$"===c?function(t){return r["$"+t]}:"$$on"===c?function(t,e){return n.on(t,e)}:"$$once"===c?function(t,e){return n.once(t,e)}:"$$off"===c?function(t,e){return n.off(t,e)}:"$$emit"===c?function(t,...e){return n.emit(t,...e)}:"$$each"===c&&f(t)?function(e,n){return o(r,"$each",e),t.map(e,n).filter((t=>t))}:(s(c)&&e.test(c)&&(c=c.slice(1),i(t[c])||o(r,c)),Reflect.get(t,c))),set:(t,e,o,c)=>{i(o)&&(o=p(c,e,o,$)),a(o)&&(o=d(o),h(c,e,o,m));const r=f(t)&&"length"===e||t[e]!==o,s=r&&g(t);if(!Reflect.set(t,e,o))return!1;if(r){const c=[e],r=l(s,e)?"#mod":"#add";f(t)&&isNaN(e)||c.push(r,"*");(async()=>n.emit(c,o,e,s))()}return!0},deleteProperty:(t,e)=>{const o=g(t);if(!Reflect.deleteProperty(t,e))return!1;$.emit(e),m.emit(e);const c=[e,"#del","*"];return(async()=>{n.emit(c,void 0,e,o)})(),!0}});for(const e in t)if(i(t[e])&&(t[e]=p(y,e,t[e],$)),a(t[e])){const n=d(t[e]);t[e]=n,h(y,e,n,m)}return y}function p(t,e,o,c){c.emit(e);const r=()=>{t[e]=o(t,e)};return n((()=>o(t,e)),((t,n)=>{t.$$on(n,r),c.once(e,(()=>t.$$off(n,r)))}))}function h(t,e,n,o){if(!n[u])return;o.emit(e);const c=(...e)=>{t.$$emit(["*"],...e)};n.$$on("*",c),o.once(e,(()=>n.$$off("*",c)))}function $(t,e){const n=f(t);for(const o in e)if(a(e[o]))if(a(t[o]))$(t[o],e[o]);else{const c=d(f(e[o])?[]:{});$(c,e[o]),n?t.splice(parseInt(o),1,c):t[o]=c}else r(e[o])||(n?t.splice(parseInt(o),1,e[o]):t[o]=e[o]);if(n){const n=f(e)?e.length:0,o=t.length-n;o>0&&t.splice(n,o)}else for(const n in t)l(e,n)||delete t[n]}function m(t,e){if(a(t)&&a(e)){for(const n in e)if(!l(t,n))return!1;for(const n in t)if(!m(t[n],e[n]))return!1}else if(t!==e)return!1;return!0}function y(t,e){if(f(t)){const n=[],o=[],c=[],r={};f(e)||(e=[]);for(let t=0;t<e.length;t++){const n=e[t];a(n)&&(l(n,"id")?r[n.id]=n:r[t]=n)}const i={};for(let e=0;e<t.length;e++){const o=t[e];if(!a(o))continue;let s;if(l(o,"id")?(s=o.id,i[s]=o):(s=e,i[s]=o),l(r,s)){const t=r[s],e={id:s};let n;for(const c in o)m(o[c],t[c])||(e[c]=o[c],n=!0);for(const c in t)l(o,c)||(e[c]=null,n=!0);n&&c.push(g(e))}else n.push(g(o))}for(const t in r){const e=r[t];l(i,t)||o.push(g(e))}return(n.length>0||c.length>0||o.length>0)&&{add:n,mod:c,del:o}}{const n={};let o=!1;for(const c in t)m(t[c],e[c])||(n[c]=t[c],o=!0);for(const c in e)l(t,c)||(n[c]=null,o=!0);return o&&n}}function g(t){if(!a(t))return t;const e=f(t)?[]:{};for(const n in t)e[n]=g(t[n]);return e}function w(t,e){if(i(t))return w(t());if(!a(t))return;const o={...t};let l;if(o.view){if(l=o.view,delete o.view,i(l))return w(l(o));if(s(l)){const t=document.createElement("div");return t.innerHTML=l,o.view=t.firstChild,w(o)}}e||"SVG"!==`${o.tagName}`.toUpperCase()||(e="http://www.w3.org/2000/svg");const{tagName:u="DIV",namespaceURI:d=e,attributes:p,on:h,children:$}=o;delete o.tagName,delete o.namespaceURI,delete o.attributes,delete o.on,delete o.children,l||(l=d?document.createElementNS(d,u):document.createElement(u));const m=new c;l.addEventListener("removed",(()=>m.emit("*")),!1),b(o,l,m);for(const t in p){let e=p[t];if(!r(e)){if(i(e)){const o=e,c=()=>l.setAttribute(t,o());e=n(o,((e,n)=>{e.$$on(n,c),m.once(t,(()=>e.$$off(n,c)))}))}l.setAttribute(t,e)}}for(const t in h){const e=h[t];i(e)&&l.addEventListener(t,e)}let y=$;if(i($)&&(y=n($,((t,e,n)=>{if(f(t)&&"$each"===e&&i(n)){const o=(t,e,o)=>{const c=parseInt(e),r=n(t,c,o);if(r){const t=w(r,d);t&&l.appendChild(t)}};t.$$on("#add",o),m.once(e,(()=>t.$$off("#add",o)));const c=(t,e,o)=>{const c=parseInt(e),r=l.children[c],i=n(t,c,o);if(i){const t=w(i,d);t&&r&&l.replaceChild(t,r)}};t.$$on("#mod",c),m.once(e,(()=>t.$$off("#mod",c)));const r=(t,e)=>{const n=parseInt(e),o=l.children[n];o&&l.removeChild(o)};t.$$on("#del",r),m.once(e,(()=>t.$$off("#del",r)))}else{const n=$,o=()=>{const t=[].concat(n());l.innerHTML="";for(const e of t){const t=w(e,d);t&&l.appendChild(t)}};t.$$on(e,o),m.once(e,(()=>t.$$off(e,o)))}}))),!r(y)){const t=[].concat(y);for(const e of t){const t=w(e,d);t&&l.appendChild(t)}}return l}function b(t,e,o,c=0){const r=(t,e,n)=>{if("classList"===e&&f(n)&&!c){const t=[];for(const e of n)e&&t.push(e);n=t.join(" ")}a(n)?b(n,t[e],o,c+1):t[e]!==n&&(t[e]=n)};for(const c in t){let s=t[c];if(i(s)){const t=s,i=()=>r(e,c,t());s=n(t,((t,e)=>{t.$$on(e,i),o.once(c,(()=>t.$$off(e,i)))}))}r(e,c,s)}}function E(t,e){if(a(t)&&(e=t,t=null),!s(t)){const{path:e}=v(location.hash);t=e}location.hash=function(t,e){const n=[];for(const t in e)n.push(`${t}=${e[t]}`);let o=t?`#${t}`:"#";n.length&&(o+=`?${n.join("&")}`);return o}(t,e)}function v(t){const e={},n=/[?&]([^=]+)=([^&]*)/g;let o=n.exec(t);for(;o;){e[decodeURIComponent(o[1])]=decodeURIComponent(o[2]),o=n.exec(t)}const c=/^#([^?]+)/.exec(t)||[];return{path:decodeURIComponent(c[1]||""),query:e}}t.createL10n=function(t,e){const{lang:n=navigator.language,fallback:o="en"}=e||{},c={lang:t[n]?n:o,locales:Object.keys(t),t:()=>i};Object.seal(c);const r=d(c);function i(e,n,c){if(s(n)&&(c=n,n=null),c||(c=r.$lang),c&&t[c]||(c=o),!c)return e;let i=`${e}`.split(".").reduce(((t,e)=>a(t)?t[e]:""),t[c]);for(const t in n){const e=new RegExp(`%{${t}}`,"g");i=i.replace(e,n[t])}return i}return r},t.createRPC=function(t){const{url:e="/api/rpc",method:n="POST",headers:o={},mode:c,credentials:r}=t,i={};return Object.seal(i),new Proxy(i,{get:(t,i)=>async function(t){const s={};if(t instanceof File||t instanceof Blob){const e=new FormData;e.append("file",t),t=e}else a(t)?(s["Content-Type"]="application/json",t=JSON.stringify(t)):t=`${t}`;const f=await fetch(`${e}/${i}`,{method:n,mode:c,credentials:r,headers:Object.defineProperties(s,{...Object.getOwnPropertyDescriptors(o)}),body:t});if(!f.ok)throw Error(f.statusText);const l=f.headers.get("content-type")||"";return/^application\/json/.test(l)?await f.json():/^application\/octet-stream/.test(l)?await f.blob():await f.text()}})},t.createRouter=function(t,e){const{home:n}=e||{};function o(){if((!location.hash||"#"===location.hash)&&n)return location.hash=n;const{path:e,query:o}=v(location.hash);r.query||(r.query={});for(const t in r.query)l(o,t)||delete r.query[t];for(const t in o)r.query[t]!==o[t]&&(r.query[t]=o[t]);for(const n in t){const o=t[n],c=e.match(o);r.params[n]=c&&c[1]}r.path=e}const c={path:"",params:{},query:{},navigate:()=>E};Object.seal(c);const r=d(c);return o(),r.$$on("*",(()=>{E(r.path,r.query)})),window.addEventListener("hashchange",(()=>o())),r},t.createState=d,t.createSync=function(t,e,n){const{slippage:o}=n||{};let c;const r=async(...n)=>{const o=c,r=g(t),i=y(r,o);return c=await e(r,o,i,...n),a(c)&&$(t,c),c};let i;return"number"==typeof o?async function(...t){return new Promise((e=>{clearTimeout(i),i=setTimeout((async()=>e(await r(...t))),i?o:0)}))}:r},t.createView=function(t,e){const n=w(t),{target:o}=e||{},c=o||n;if(c){const t=function(t){const e=new MutationObserver((function(t){const e=(t,n)=>{const o=t.children;for(let t=0;t<o.length;t++)e(o[t],n);const c=new CustomEvent(n);t.dispatchEvent(c)};for(const n of t)if("childList"===n.type)n.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&e(t,"mounted")})),n.removedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&e(t,"removed")}));else if("attributes"===n.type){const t=n.target,e=new CustomEvent("changed",{detail:{attributeName:n.attributeName,oldValue:n.oldValue,newValue:t.getAttribute(n.attributeName)}});t.dispatchEvent(e)}}));return e.observe(t,{childList:!0,subtree:!0,attributeOldValue:!0}),e}(c);c.addEventListener("removed",(()=>t.disconnect()),!1),o&&n&&o.appendChild(n)}return n},t.deepClone=g,t.deepDiff=y,t.deepPatch=$,t.isEqual=m}));
