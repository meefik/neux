!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).NEUX={})}(this,(function(t){"use strict";let n;function e(t,e){if(n)throw Error("Collision in state binding");const o=n=new Map,c=t();n=null;for(const t of o){const[n,o]=t;for(const t in o)e(n,t,o[t])}return c}function o(t,e,o){if(!n)return;const c=n.get(t)||{};c[e]=o||null,n.set(t,c)}class c{#t={};on(t,n){if(t&&n){const e=this.#t,o=[].concat(t);for(const t of o)e[t]||(e[t]=new Map),e[t].set(n,!1)}}once(t,n){if(t&&n){const e=this.#t,o=[].concat(t);for(const t of o)e[t]||(e[t]=new Map),e[t].set(n,!0)}}off(t,n){if(t){const e=this.#t,o=[].concat(t);for(const t of o)e[t]&&(n?(e[t].delete(n),e[t].size||delete e[t]):(e[t].clear(),delete e[t]))}}emit(t,...n){const e=this.#t;if("*"===t)for(const t in e)for(const[o,c]of e[t])o(...n),c&&this.off(t,o);else{const o=new Set([].concat(t));for(const t of o)if(e[t])for(const[o,c]of e[t])o(...n),c&&this.off(t,o)}}}function r(t){return void 0===t}function s(t){return"function"==typeof t}function i(t){return"string"==typeof t}function f(t){return Array.isArray(t)}function a(t){return"object"==typeof t&&null!==t&&(t.constructor===Object||t.constructor===Array)}function l(t,n){return a(t)&&Object.prototype.hasOwnProperty.call(t,n)}const u=Symbol("isProxy");function d(t){if(r(t)&&(t={}),t[u]||!a(t))return t;const n=/^\$/,e=new c,m=new c,$=new c,g=new Proxy(t,{get:(t,c,r)=>c===u||("$"===c?function(t){return r["$"+t]}:"$$on"===c?function(t,n){return e.on(t,n)}:"$$once"===c?function(t,n){return e.once(t,n)}:"$$off"===c?function(t,n){return e.off(t,n)}:"$$emit"===c?function(t,...n){return e.emit(t,...n)}:"$$each"===c&&f(t)?function(n,e){return o(r,"$each",n),t.map(n,e).filter((t=>t))}:(i(c)&&n.test(c)&&(c=c.slice(1),s(t[c])||o(r,c)),Reflect.get(t,c))),set:(t,n,o,c)=>{s(o)&&(o=p(c,n,o,m)),a(o)&&(o=d(o),h(c,n,o,$));const r=f(t)&&"length"===n||t[n]!==o,i=r&&w(t);if(!Reflect.set(t,n,o))return!1;if(r){const c=[n],r=l(i,n)?"#mod":"#add";f(t)&&isNaN(n)||c.push(r,"*");(async()=>e.emit(c,o,n,i))()}return!0},deleteProperty:(t,n)=>{const o=w(t);if(!Reflect.deleteProperty(t,n))return!1;m.emit(n),$.emit(n);const c=[n,"#del","*"];return(async()=>{e.emit(c,void 0,n,o)})(),!0}});for(const n in t)if(s(t[n])&&(t[n]=p(g,n,t[n],m)),a(t[n])){const e=d(t[n]);t[n]=e,h(g,n,e,$)}return g}function p(t,n,o,c){c.emit(n);const r=()=>{t[n]=o(t,n)};return e((()=>o(t,n)),((t,e)=>{t.$$on(e,r),c.once(n,(()=>t.$$off(e,r)))}))}function h(t,n,e,o){if(!e[u])return;o.emit(n);const c=(...n)=>{t.$$emit(["*"],...n)};e.$$on("*",c),o.once(n,(()=>e.$$off("*",c)))}function m(t,n){const e=f(t);for(const o in n)if(a(n[o]))if(a(t[o]))m(t[o],n[o]);else{const c=d(f(n[o])?[]:{});m(c,n[o]),e?t.splice(parseInt(o),1,c):t[o]=c}else r(n[o])||(e?t.splice(parseInt(o),1,n[o]):t[o]=n[o]);if(e){const e=f(n)?n.length:0,o=t.length-e;o>0&&t.splice(e,o)}else for(const e in t)l(n,e)||delete t[e]}function $(t,n){if(a(t)&&a(n)){for(const e in n)if(!l(t,e))return!1;for(const e in t)if(!$(t[e],n[e]))return!1}else if(t!==n)return!1;return!0}function g(t,n){if(f(t)){const e=[],o=[],c=[],r={};f(n)||(n=[]);for(let t=0;t<n.length;t++){const e=n[t];a(e)&&(l(e,"id")?r[e.id]=e:r[t]=e)}const s={};for(let n=0;n<t.length;n++){const o=t[n];if(!a(o))continue;let i;if(l(o,"id")?(i=o.id,s[i]=o):(i=n,s[i]=o),l(r,i)){const t=r[i],n={id:i};let e;for(const c in o)$(o[c],t[c])||(n[c]=o[c],e=!0);for(const c in t)l(o,c)||(n[c]=null,e=!0);e&&c.push(w(n))}else e.push(w(o))}for(const t in r){const n=r[t];l(s,t)||o.push(w(n))}return(e.length>0||c.length>0||o.length>0)&&{add:e,mod:c,del:o}}{const e={};let o=!1;for(const c in t)$(t[c],n[c])||(e[c]=t[c],o=!0);for(const c in n)l(t,c)||(e[c]=null,o=!0);return o&&e}}function w(t){if(!a(t))return t;const n=f(t)?[]:{};for(const e in t)n[e]=w(t[e]);return n}function y(t,n){if(s(t))return y(t());if(!a(t))return;const o={...t};let l;if(o.view){if(l=o.view,delete o.view,s(l))return y(l(o));if(i(l)){const t=document.createElement("div");return t.innerHTML=l,o.view=t.firstChild,y(o)}}n||"SVG"!==`${o.tagName}`.toUpperCase()||(n="http://www.w3.org/2000/svg");const{tagName:u="DIV",namespaceURI:d=n,attributes:p,on:h,children:m}=o;delete o.tagName,delete o.namespaceURI,delete o.attributes,delete o.on,delete o.children,l||(l=d?document.createElementNS(d,u):document.createElement(u));const $=new c;l.addEventListener("removed",(()=>$.emit("*")),!1),b(o,l,$);for(const t in p){let n=p[t];if(!r(n)){if(s(n)){const o=n,c=()=>l.setAttribute(t,o());n=e(o,((n,e)=>{n.$$on(e,c),$.once(t,(()=>n.$$off(e,c)))}))}l.setAttribute(t,n)}}for(const t in h){const n=h[t];s(n)&&l.addEventListener(t,n)}let g=m;if(s(m)&&(g=e(m,((t,n,e)=>{if(f(t)&&"$each"===n&&s(e)){const o=(t,n,o)=>{const c=parseInt(n),r=e(t,c,o);if(r){const t=y(r,d);t&&l.appendChild(t)}};t.$$on("#add",o),$.once(n,(()=>t.$$off("#add",o)));const c=(t,n,o)=>{const c=parseInt(n),r=l.children[c],s=e(t,c,o);if(s){const t=y(s,d);t&&r&&l.replaceChild(t,r)}};t.$$on("#mod",c),$.once(n,(()=>t.$$off("#mod",c)));const r=(t,n)=>{const e=parseInt(n),o=l.children[e];o&&l.removeChild(o)};t.$$on("#del",r),$.once(n,(()=>t.$$off("#del",r)))}else{const e=m,o=()=>{const t=[].concat(e());l.innerHTML="";for(const n of t){const t=y(n,d);t&&l.appendChild(t)}};t.$$on(n,o),$.once(n,(()=>t.$$off(n,o)))}}))),!r(g)){const t=[].concat(g);for(const n of t){const t=y(n,d);t&&l.appendChild(t)}}return l}function b(t,n,o,c=0){const r=(t,n,e)=>{if("classList"===n&&f(e)&&!c){const t=[];for(const n of e)n&&t.push(n);e=t.join(" ")}a(e)?b(e,t[n],o,c+1):t[n]!==e&&(t[n]=e)};for(const c in t){let i=t[c];if(s(i)){const t=i,s=()=>r(n,c,t());i=e(t,((t,n)=>{t.$$on(n,s),o.once(c,(()=>t.$$off(n,s)))}))}r(n,c,i)}}function E(t,n){if(a(t)&&(n=t,t=null),!i(t)){const{path:n}=v(location.hash);t=n}location.hash=function(t,n){const e=[];for(const t in n)e.push(`${t}=${n[t]}`);let o=t?`#${t}`:"#";e.length&&(o+=`?${e.join("&")}`);return o}(t,n)}function v(t){const n={},e=/[?&]([^=]+)=([^&]*)/g;let o=e.exec(t);for(;o;){n[decodeURIComponent(o[1])]=decodeURIComponent(o[2]),o=e.exec(t)}const c=/^#([^?]+)/.exec(t)||[];return{path:decodeURIComponent(c[1]||""),params:n}}t.createL10n=function(t){const{lang:n=navigator.language,fallback:e="en",locales:o={}}=t||{},c={lang:o[n]?n:e,fallback:e,locales:o,t:()=>s};Object.seal(c);const r=d(c);function s(t,n,e){i(n)&&(e=n,n=null);const o=r.locales||{};if(e||(e=r.$lang),e&&o[e]||(e=r.fallback),!e)return"";let c=`${t}`.split(".").reduce(((t,n)=>a(t)?t[n]:""),o[e]);for(const t in n){const e=new RegExp(`%{${t}}`,"g");c=c.replace(e,n[t])}return c}return r},t.createRPC=function(t){const{url:n="/api/rpc",method:e="POST",headers:o={},mode:c,credentials:r}=t,s={};return Object.seal(s),new Proxy(s,{get:(t,s)=>async function(t){const i={};if(t instanceof File||t instanceof Blob){const n=new FormData;n.append("file",t),t=n}else a(t)?(i["Content-Type"]="application/json",t=JSON.stringify(t)):t=`${t}`;const f=await fetch(`${n}/${s}`,{method:e,mode:c,credentials:r,headers:Object.defineProperties(i,{...Object.getOwnPropertyDescriptors(o)}),body:t});if(!f.ok)throw Error(f.statusText);const l=f.headers.get("content-type")||"";return/^application\/json/.test(l)?await f.json():/^application\/octet-stream/.test(l)?await f.blob():await f.text()}})},t.createRouter=function(t){function n(){if((!location.hash||"#"===location.hash)&&c.home)return location.hash=c.home;const{path:t,params:n}=v(location.hash);c.params||(c.params={});for(const t in c.params)l(n,t)||delete c.params[t];for(const t in n)c.params[t]!==n[t]&&(c.params[t]=n[t]);c.path=t}const{home:e}=t||{},o={home:e,path:"",params:{},navigate:()=>E};Object.seal(o);const c=d(o);return n(),c.$$on("*",(()=>{E(c.path,c.params)})),window.addEventListener("hashchange",(()=>n())),c},t.createState=d,t.createSync=function(t,n,e){const{slippage:o}=e||{};let c;const r=async(...e)=>{const o=c,r=w(t),s=g(r,o);return c=await n(r,o,s,...e),a(c)&&m(t,c),c};let s;return"number"==typeof o?async function(...t){return new Promise((n=>{clearTimeout(s),s=setTimeout((async()=>n(await r(...t))),s?o:0)}))}:r},t.createView=function(t,n){const e=y(t),o=n||e;if(o){const t=function(t){const n=new MutationObserver((function(t){const n=(t,e)=>{const o=t.children;for(let t=0;t<o.length;t++)n(o[t],e);const c=new Event(e);t.dispatchEvent(c)};for(const e of t)e.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&n(t,"mounted")})),e.removedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&n(t,"removed")}))}));return n.observe(t,{childList:!0,subtree:!0}),n}(o);o.addEventListener("removed",(()=>t.disconnect()),!1),n&&e&&n.appendChild(e)}return e},t.deepClone=w,t.deepDiff=g,t.deepPatch=m,t.isEqual=$}));
