function e(e){return void 0===e}function t(e){return"function"==typeof e}function n(e){return"string"==typeof e}function o(e){return Array.isArray(e)}function r(e){return"object"==typeof e&&null!==e&&(e.constructor===Object||e.constructor===Array)}function s(e){for(let t in e)return!1;return!0}const i=Symbol("context"),c={};function l(e){return r(e)?e:c}function f(e,t,n){const o=new Map,r=e[i];e[i]=o;const s=t();r?e[i]=r:delete e[i];for(let e of o){const[t,o]=e;for(let e in o)n(t,e)}return s}class a extends Map{constructor(e){super(),this._ctx=e}on(e,t){if(e&&t){const n=[].concat(e);for(let e of n)this.has(e)||this.set(e,new Map),this.get(e).set(t,!1)}}once(e,t){if(e&&t){const n=[].concat(e);for(let e of n)this.has(e)||this.set(e,new Map),this.get(e).set(t,!0)}}off(e,t){if(e){const n=[].concat(e);for(let e of n)this.has(e)&&(t?(this.get(e).delete(t),this.get(e).size||this.delete(e)):(this.get(e).clear(),this.delete(e)))}}emit(e,...t){if(e){const n=[].concat(e);for(let e of n)if(this.has(e))for(let[n,o]of this.get(e)){o&&this.off(e,n);try{n.apply(this._ctx,t)}catch(e){console.error(e)}}}}}const u=Symbol("signal");function d(e){let t=0;if(n(e))for(;e.startsWith("$");)e=e.slice(1),t++;return[t>0&&(e||(t>1?"*":"#")),e]}function h(e,t,n,o,r){return r.emit(n),f(e,o=o.bind(e,t,n),((e,s)=>{const i=()=>{t[n]=o()};e.$$on(s,i),r.once(n,(()=>e.$$off(s,i)))}))}function m(e,t,n,o){if(o.emit(t),n[u]){const r=(n,o,r,s,i=[])=>{e.$$emit("*",n,o,r,s,[...i,t])};n.$$on("*",r),o.once(t,(()=>n.$$off("*",r)))}}function p(e,n){const o=l(this),r=t(e)?e.bind(o):()=>e,s=n?n.bind(o):()=>{},i=new Set,c=f(o,r,((e,t)=>{let n;const o=()=>{clearTimeout(n),n=setTimeout((()=>s(r())),0)};e.$$on(t,o),i.add((()=>e.$$off(t,o)))}));if(s(c),i.size>0){return()=>{for(let e of i)e();i.clear()}}}function g(e={}){if(!r(e)||e[u])return e;const n=l(this),s=new a(n),c=new a,f=new a,p={$$on:(e,t)=>s.on(e,t),$$once:(e,t)=>s.once(e,t),$$off:(e,t)=>s.off(e,t),$$emit:(e,...t)=>s.emit(e,...t)},w={get:(e,t)=>{if(t===u)return!0;if(t in p)return p[t];const[o,r]=d(t);return o&&(function(e,t,n){const o=e[i];if(o){const e=o.get(t)||{};e[n]=!0,o.set(t,e)}}(n,y,o),!r)?y:Reflect.get(e,r)},set:(e,i,l)=>{const[a]=d(i);if(a)return!1;const u=e[i];if(t(l)){l=h(n,y,i,l,f)}r(l)&&(l=g.call(n,l),m(y,i,l,c));const p="length"===i&&o(e),w=e[i]!==l||p;return!!Reflect.set(e,i,l)&&(w&&s.emit(p?i:[i,"#","*"],l,u,i,y),!0)},deleteProperty:(e,t)=>{const[n]=d(t);if(n)return!1;const o=e[t];return!!Reflect.deleteProperty(e,t)&&(c.emit(t),f.emit(t),s.emit([t,"#","*"],void 0,o,t,y),!0)}},y=new Proxy(e,w),v=Object.keys(e);for(let o of v){const[s]=d(o);if(!s){if(t(e[o])){const t=e[o];e[o]=h(n,y,o,t,f)}if(r(e[o])){const t=g.call(n,e[o]);e[o]=t,m(y,o,t,c)}}}return y}function w(i,c){const{document:f,Node:a,CustomEvent:u}=window,d=l(this);if(t(i)&&(i=i.call(d)),n(i))return f.createTextNode(i);if(!r(i))return i;if(o(i)){const e=f.createDocumentFragment();for(let t of i){const n=w.call(d,t,c);n instanceof a&&e.appendChild(n)}return e}const{tag:h,tagName:m="div",namespaceURI:g=c,shadowRootMode:y,adoptedStyleSheets:v,on:E,ref:$,...N}=i,L=new Map,M=e=>{if(e){for(let t of L.keys())if(t.startsWith(e)){for(let e of L.get(t))e();L.delete(t)}}else{for(let e of L.values())for(let t of e)t();L.clear()}},A=(e,t)=>{L.has(e)?L.get(e).push(t):L.set(e,[t])},S=r(h)||t(h)?w.call(d,h,g):function(e,t){const{document:o,customElements:r,Element:s}=window,i=[];let c,l,f="div";if(n(e))if(/[^a-zA-Z0-9-_.#]/u.test(e)){const t=o.createElement("div");t.innerHTML=e,t.firstChild instanceof s&&(c=t.firstChild,f=c.tagName)}else{const t=e.match(/([.#]?[^\s#.]+)/gu)||[];for(let e of t){const t=e[0];"."===t?i.push(e.slice(1)):"#"===t?l=e.slice(1):f=e}}else e instanceof s&&(c=e,f=c.tagName);if(!c){const e=r?.get(f);if(e)c=new e;else{if("http://www.w3.org/1999/xhtml"===t&&(t=null),!t)switch(`${f}`.toLowerCase()){case"svg":t="http://www.w3.org/2000/svg";break;case"math":t="http://www.w3.org/1998/Math/MathML"}c=t?o.createElementNS(t,f):o.createElement(f)}}return l&&(c.id=l),i.length&&(c.className=i.join(" ")),c}(h||m,g);let j;if(c=S.namespaceURI,y&&(j=S.attachShadow({mode:y}),j&&v&&(j.adoptedStyleSheets=v)),!e(E))for(let e in E){const n=E[e];t(n)&&S.addEventListener(e,(e=>n.call(d,e)))}const C=({children:e},t)=>{for(let n of e){const e=new u(t,{cancelable:!0});n.dispatchEvent(e)}};S.addEventListener("mounted",(e=>{e.defaultPrevented||C(S,"mounted")})),S.addEventListener("removed",(e=>{e.defaultPrevented||(M(),C(S,"removed"))})),S.addEventListener("refresh",(e=>{if(!e.defaultPrevented)if(e.detail){const t=[].concat(e.detail);for(let e of t){const t=e.split("."),n=t.reduce(((e,n,o)=>e&&(o>=t.length-1?{[n]:e[n]}:e[n])),N);T(n,t.slice(0,-1))}}else T(N)}));const T=(t,o=[])=>{for(let r in t){const i=[...o,r],l=i.join("."),[f,h]=i,m=t[r];M(l);const g=p.call(d,m,(t=>{const o=null==t;if("children"===f){const e=j||S,n=w.call(d,t,c);if(n instanceof a){const t=Array.from(e[f]),o=n.nodeType===a.DOCUMENT_FRAGMENT_NODE;b(e,t,Array.from(o?n[f]:[n]))}else e.innerHTML="",M(l+".");t=n}else if("classList"===f)Array.isArray(t)?t=t.filter(Boolean).join(" "):n(t)||(t=""),S.classList=t;else if("attributes"===f)if(h)o?S.removeAttribute(h):S.setAttribute(h,t);else{if(!s(t))return T(t,i);{const e=Object.keys(S[f]);for(let t of e)delete S[f][t].name;M(l+".")}}else if("style"===f)if(h)/[A-Z]/u.test(h)?o?delete S[f][h]:S[f][h]=t:o?S[f].removeProperty(h):S[f].setProperty(h,t);else{if(!s(t))return T(t,i);S.removeAttribute("style"),M(l+".")}else if("dataset"===f)if(h)o?delete S[f][h]:S[f][h]=t;else{if(!s(t))return T(t,i);{const e=Object.keys(S[f]);for(let t of e)delete S[f][t];M(l+".")}}else{const{obj:n,key:r}=i.reduce(((t,n,o)=>o===i.length-1?{obj:t,key:n}:(e(t[n])&&(t[n]={}),t[n])),S);o?(delete n[r],M(l+".")):n[r]=t}S.dispatchEvent(new u("updated",{detail:{property:l,value:t},cancelable:!0}))}));g&&A(l,g)}};return T(N),t($)&&$.call(d,S),S}function y(t,n,s){return o(t)?w.call(this,t):(r(t)&&(s=n,n=t,t=null),r(n)&&!o(n)||(s=n,n={}),e(s)||(n={children:s,...n}),w.call(this,{tag:t,...n}))}function v(e,t){const{MutationObserver:o,CustomEvent:r,Node:s,document:i}=window,c=(e,t)=>{if(e.nodeType!==s.ELEMENT_NODE)return;const n=new r(t,{cancelable:!0});e.dispatchEvent(n)};n(t)&&(t=i.querySelector(t));const l=new o((t=>{for(let n of t)if("childList"===n.type)n.addedNodes.forEach((e=>{e.parentNode&&c(e,"mounted")})),n.removedNodes.forEach((t=>{t.parentNode||c(t,"removed"),t===e&&l.disconnect()}));else if("attributes"===n.type){const e=n.target,{attributeName:t}=n,{oldValue:o}=n,s=e.getAttribute(t);if(o!==s){const n=new r("changed",{detail:{attributeName:t,oldValue:o,newValue:s}});e.dispatchEvent(n)}}}));l.observe(t,{childList:!0,subtree:!0,attributeOldValue:!0}),t.appendChild(e)}function b(e,t,n){let o=0,r=0,s=t.length-1,i=n.length-1;for(;o<=s&&r<=i&&t[o].isEqualNode(n[r]);)o++,r++;for(;o<=s&&r<=i&&t[s].isEqualNode(n[i]);)s--,i--;if(o>s){const o=t[s+1]||null;for(;r<=i;)e.insertBefore(n[r++],o)}else if(r>i)for(;o<=s;)e.removeChild(t[o++]);else{const c=new Map;for(let e=o;e<=s;e++)c.set(t[e],e);for(;r<=i;){const t=n[r];let s=null;for(let[e]of c)if(e.isEqualNode(t)){s=e;break}const i=e.children[o];s?(e.insertBefore(s,i),c.delete(s)):e.insertBefore(t,i),r++,o++}for(let[t]of c)e.removeChild(t)}}function E(s,i){const{language:c=navigator.language,fallback:l="en"}=i||{},f=(e,t)=>{const n=s[t]||{};return e in n?n[e]:e.split(".").reduce(((e,t)=>r(e)?e[t]:""),n)};return(r,i,a=c)=>{if(n(i)&&(a=i,i=null),a&&s[a]||(a=l),n(r)){let s=f(r,a);return a!==l&&e(s)&&(s=f(r,l)),((e,r,s)=>{if(n(e))for(let n in r){const i=new RegExp(`%\\{${n}\\}`,"gu");let c=r[n];if(o(c)){const[e,n]=c;c=t(e?.toLocaleString)?e.toLocaleString(s,n):e}e=e.replace(i,c)}return e})(e(s)?r:s,i,a)}return t(r?.toLocaleString)?r.toLocaleString(a,i):r}}export{p as effect,E as l10n,v as mount,y as render,g as signal};
