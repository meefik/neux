class t{_list={};on(t,e){if(t&&e){const n=this._list,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!1)}}once(t,e){if(t&&e){const n=this._list,o=[].concat(t);for(const t of o)n[t]||(n[t]=new Map),n[t].set(e,!0)}}off(t,e){if(t){const n=this._list,o=[].concat(t);for(const t of o)n[t]&&(e?(n[t].delete(e),n[t].size||delete n[t]):(n[t].clear(),delete n[t]))}}emit(t,...e){const n=this._list;if("*"===t)for(const t in n)for(const[o,c]of n[t])o(...e),c&&this.off(t,o);else{const o=new Set([].concat(t));for(const t of o)if(n[t])for(const[o,c]of n[t])o(...e),c&&this.off(t,o)}}}function e(t){return void 0===t}function n(t){return"function"==typeof t}function o(t){return"string"==typeof t}function c(t){return Array.isArray(t)}function i(t){return"object"==typeof t&&null!==t&&(t.constructor===Object||t.constructor===Array)}function r(t,e){return i(t)&&Object.prototype.hasOwnProperty.call(t,e)}const s=Symbol("isProxy"),a=/^\$/,f={};function u(r,w=f){if(e(r))r={};else if(!i(r)||r[s])return r;const y=new t,g=new t,v=new t,b=new Proxy(r,{get:(t,e,i)=>e===s||("$"===e?function(t){return i["$"+t]}:"$$on"===e?function(...t){return y.on(...t)}:"$$once"===e?function(...t){return y.once(...t)}:"$$off"===e?function(...t){return y.off(...t)}:"$$emit"===e?function(...t){return y.emit(...t)}:"$$watch"===e?function(t,e,n){return d(w,i,t,e,n,g)}:"$$unwatch"===e?function(t="*"){g.emit(t)}:"$$clone"===e?function(e=t){return p(e)}:"$$equal"===e?function(e,n=t){return m(e,n)}:"$$patch"===e?function(t,e=i){return $(w,t,e)}:"$$each"===e&&c(t)?function(e,o){return n(e)&&l(w,i,"#",e),t.map(e,o).filter((t=>t))}:(o(e)&&a.test(e)&&(e=e.slice(1),n(t[e])||l(w,i,e)),Reflect.get(t,e))),set:(t,e,o,r)=>{const s=p(t[e]);if(n(o)){o=d(w,r,e,o,(t=>t),g)}i(o)&&(o=u(o,w),h(r,e,o,v));const a=c(t)&&"length"===e||t[e]!==o;if(!Reflect.set(t,e,o))return!1;if(a){const n=[e,"*"];c(t)&&!isNaN(e)&&n.push("#");(async()=>{y.emit(n,o,s,e,r)})()}return!0},deleteProperty:(t,e,n)=>{const o=p(t[e]);if(!Reflect.deleteProperty(t,e))return!1;g.emit(e),v.emit(e);const i=[e,"*"];c(t)&&!isNaN(e)&&i.push("#");return(async()=>{y.emit(i,void 0,o,e,n)})(),!0}});for(const t in r){if(n(r[t])){const e=r[t],n=t=>t;r[t]=d(w,b,t,e,n,g)}if(i(r[t])){const e=u(r[t],w);r[t]=e,h(b,t,e,v)}}return b}function l(t,e,n,o){const c=t.value;if(!c)return;const i=c.get(e)||{};i[n]=o||null,c.set(e,i)}function d(t,o,c,i,r,s){let a=function(t,e,n){if(t.value)throw Error("Collision in state binding");const o=t.value=new Map,c=e();delete t.value;for(const t of o){const[e,o]=t;for(const t in o)n(e,t,o[t])}return c}(t,(()=>i(o,c)),((t,f,u)=>{let l;l=u?(t,i,s,a)=>{if(!isNaN(s))if(s=parseInt(s),e(i)||(i=u(i,s,a)),e(t)||(t=u(t,s,a)),n(r)){e(r(t,i,s,a))||(o[c]=a)}else o.$$emit(c,t,i,s,a)}:()=>{const t=i(o,c);if(n(r)){const n=r(t,a,c,o);e(n)||(o[c]=n)}else o.$$emit(c,t,a,c,o);a=t},t.$$on(f,l),s.once(c,(()=>t.$$off(f,l)))}));return a}function h(t,e,n,o){if(o.emit(e),!n[s])return;const c=(...n)=>{t.$$emit(["*"],...n,e)};n.$$on("*",c),o.once(e,(()=>n.$$off("*",c)))}function p(t){if(!i(t))return t;const e=c(t)?[]:{};for(const n in t)e[n]=p(t[n]);return e}function $(t,n,o){const s=c(o);for(const r in n)if(i(n[r]))if(i(o[r]))$(t,n[r],o[r]);else{const e=u(c(n[r])?[]:{},t);$(t,n[r],e),s?o.splice(parseInt(r),1,e):o[r]=e}else e(n[r])||(s?o.splice(parseInt(r),1,n[r]):o[r]=n[r]);if(s){const t=c(n)?n.length:0,e=o.length-t;e>0&&o.splice(t,e)}else for(const t in o)r(n,t)||delete o[t]}function m(t,e){if(i(t)&&i(e)){for(const n in e)if(!r(t,n))return!1;for(const n in t)if(!m(t[n],e[n]))return!1}else if(t!==e)return!1;return!0}function w(t,e){const{target:n,context:o}=e||{},c=y(t,o),i=n||c;if(i){const t=function(t){const e=new MutationObserver((function(t){const e=(t,n)=>{const o=t.children;for(let t=0;t<o.length;t++)e(o[t],n);const c=new CustomEvent(n);t.dispatchEvent(c)};for(const n of t)if("childList"===n.type)n.addedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&e(t,"mounted")})),n.removedNodes.forEach((t=>{t.nodeType===Node.ELEMENT_NODE&&e(t,"removed")}));else if("attributes"===n.type){const t=n.target,e=new CustomEvent("changed",{detail:{attributeName:n.attributeName,oldValue:n.oldValue,newValue:t.getAttribute(n.attributeName)}});t.dispatchEvent(e)}}));return e.observe(t,{childList:!0,subtree:!0,attributeOldValue:!0}),e}(i);i.addEventListener("removed",(()=>t.disconnect()),!1),n&&c&&n.appendChild(c)}return c}function y(t,r,s){if(!i(t))return;let a;if((t={...t}).view){if(a=t.view,delete t.view,n(a))return y(a(t),r,s);if(o(a)){const e=document.createElement("div");return e.innerHTML=a,t.view=e.firstChild,y(t,r,s)}}s||"SVG"!==`${t.tagName}`.toUpperCase()||(s="http://www.w3.org/2000/svg");const{tagName:f="DIV",namespaceURI:l=s,attributes:d,classList:h,on:p,children:$}=t;delete t.tagName,delete t.namespaceURI,delete t.attributes,delete t.classList,delete t.on,delete t.children,a||(a=l?document.createElementNS(l,f):document.createElement(f));const m=u({},r);a.addEventListener("removed",(()=>{delete m["*"]}),!1);for(const t in p){const e=p[t];n(e)&&a.addEventListener(t,e)}for(const t in d){const e=d[t],o=e=>{a.setAttribute(t,e)};if(n(e)){const n=e;o(m.$$watch(`attributes.${t}`,n,o))}else o(e)}if(!e(h)){const t=t=>{c(t)&&(t=t.join(" ")),a.classList=t};if(n(h)){const e=h;t(m.$$watch("classList",e,t))}else t(h)}if(g(m,a,t),!e($)){const t="children",o=(n,o,c)=>{if(c===t){if(!e(n)){a.innerHTML="";const t=[].concat(n);for(const e of t){const t=y(e,r,l);t&&a.appendChild(t)}}}else if(e(n)){const t=a.children[c];t&&a.removeChild(t)}else if(e(o)){const t=y(n,r,l);t&&a.appendChild(t)}else{const t=a.children[c],e=y(n,r,l);e&&t&&a.replaceChild(e,t)}};if(n($)){const e=$;o(m.$$watch(t,e,o),void 0,t)}else o($,void 0,t)}return a}function g(t,o,c,...r){for(const s in c){const a=c[s];if(i(a)){const e=o[s];e&&g(t,e,a,...r,s)}else if(!e(a)){const e=t=>{o[s]=t};if(n(a)){const n=[].concat(r,s).join("."),o=a;e(t.$$watch(n,o,e))}else e(a)}}}function v(t,e){const{lang:n=navigator.language,fallback:c="en",context:r}=e||{};function s(e,n,r){if(o(n)&&(r=n,n=null),r||(r=a.$lang),r&&t[r]||(r=c),!r)return e;let s=`${e}`.split(".").reduce(((t,e)=>i(t)?t[e]:""),t[r]);for(const t in n){const e=new RegExp(`%{${t}}`,"g");s=s.replace(e,n[t])}return s}const a=u({lang:t[n]?n:c,locales:Object.keys(t),t:()=>s},r);return Object.seal(a),a}function b(t,e){const{home:n,context:o}=e||{};function c(){if((!location.hash||"#"===location.hash)&&n)return location.hash=n;const{path:e,query:o}=N(location.hash);i.query||(i.query={});for(const t in i.query)r(o,t)||delete i.query[t];for(const t in o)i.query[t]!==o[t]&&(i.query[t]=o[t]);for(const n in t){const o=t[n],c=e.match(o);i.params[n]=c&&c[1]}i.path=e}const i=u({path:"",params:{},query:{},navigate:()=>E},o);return Object.seal(i),c(),i.$$on("*",(()=>{E(i.path,i.query)})),window.addEventListener("hashchange",(()=>c())),i}function E(t,e){if(i(t)&&(e=t,t=null),!o(t)){const{path:e}=N(location.hash);t=e}location.hash=function(t,e){const n=[];for(const t in e)n.push(`${t}=${e[t]}`);let o=t?`#${t}`:"#";n.length&&(o+=`?${n.join("&")}`);return o}(t,e)}function N(t){const e={},n=/[?&]([^=]+)=([^&]*)/g;let o=n.exec(t);const c=decodeURIComponent;for(;o;){e[c(o[1])]=c(o[2]),o=n.exec(t)}return{path:c((/^#([^?]+)/.exec(t)||[])[1]||""),query:e}}function O(t){const{url:e="/api/rpc",method:n="POST",headers:o={},mode:c,credentials:r}=t,s={};Object.seal(s);return new Proxy(s,{get:(t,s)=>async function(t){const a={};if(t instanceof File||t instanceof Blob){const e=new FormData;e.append("file",t),t=e}else i(t)?(a["Content-Type"]="application/json",t=JSON.stringify(t)):t=`${t}`;const f=await fetch(`${e}/${s}`,{method:n,mode:c,credentials:r,headers:Object.defineProperties(a,{...Object.getOwnPropertyDescriptors(o)}),body:t});if(!f.ok)throw Error(f.statusText);const u=f.headers.get("content-type")||"";return/^application\/json/.test(u)?await f.json():/^application\/octet-stream/.test(u)?await f.blob():await f.text()}})}function j(t,e,n){const{slippage:o}=n||{};let c;const r=async(...n)=>{const o=c,r=t.$$clone();return c=await e(r,o,...n),i(c)&&t.$$patch(c),c};let s;return"number"==typeof o?async function(...t){return new Promise((e=>{clearTimeout(s),s=setTimeout((async()=>e(await r(...t))),s?o:0)}))}:r}export{v as createL10n,O as createRPC,b as createRouter,u as createState,j as createSync,w as createView};
