function t(t){return void 0===t}function e(t){return"function"==typeof t}function n(t){return"string"==typeof t}function o(t){return Array.isArray(t)}function s(t){return"object"==typeof t&&null!==t&&(t.constructor===Object||t.constructor===Array)}function c(t){return t instanceof Date}function i(t){if(!s(t))return t;const e=o(t)?[]:{};for(const n in t)e[n]=i(t[n]);return e}const r=Symbol("context"),l={};function a(t){return s(t)?t:l}function f(t,e,n,o){const s=t[r];if(s){const t=s.get(e)||{};t[n]=o||null,s.set(e,t)}}function u(t,e,n){if(t[r])throw Error("Collision in signal binding");const o=new Map;t[r]=o;const s=e();delete t[r];for(const t of o){const[e,o]=t;for(const t in o)n(e,t,o[t])}return s}class d{constructor(t){this._list={},this._context=t}on(t,e,n){if(t&&e){const o=this._list,s=[].concat(t);for(const t of s)o[t]||(o[t]=new Map),o[t].set(e,n)}}off(t,e){if(t){const n=this._list,o=[].concat(t);for(const t of o)n[t]&&(e?(n[t].delete(e),n[t].size||delete n[t]):(n[t].clear(),delete n[t]))}else this._list={}}emit(t,...n){const o=this._list,s="*"===t?Object.keys(o):[].concat(t);for(const t of s)if(o[t])for(const[s,c]of o[t])try{s.apply(this._context,n),(e(c)?c():c)&&this.off(t,s)}catch(t){console.error(t)}}}const h=Symbol("signal"),m=/^\$([^$]|$)/u;function p(n,o,s,c,i){i.emit(s),c=c.bind(n,o,s);return u(n,c,((r,l,a)=>{const f=(a=e(a)?a.bind(n):null)?(e,n,c,i)=>{const r=o[s],l=parseInt(c,10);if(t(e))r.splice(l,1);else if(t(n)){const t=a(e,l,i);r[l]=t}else{const t=a(e,l,i);r.splice(l,1,t)}}:()=>{o[s]=c()};r.$$on(l,f),i.on(s,(()=>r.$$off(l,f)),!0)}))}function w(t,e,n,o){if(o.emit(e),n[h]){const s=(n,o,s,c,i=[])=>{t.$$emit([e,"*"],n,o,s,c,[...i,e])};n.$$on("*",s),o.on(e,(()=>n.$$off("*",s)),!0)}}function g(n,o,s){const c=a(this);n=n.bind(c),o=o?o.bind(c):()=>{};const i=[],r=u(c,n,((r,l,a)=>{const f=(a=e(a)?a.bind(c):null)?(e,n,s,c)=>{const i=+s;if(t(e))o(void 0,i,"del");else if(t(n)){const t=a(e,i,c);o(t,i,"add")}else{const t=a(e,i,c);o(t,i,"upd")}}:(...t)=>{o(n(...t))};r.$$on(l,f,s),i.push((()=>r.$$off(l,f)))}));return o(r),()=>{for(const t of i)t()}}function $(t={}){if(!s(t)||t[h])return t;const c=a(this),r=new d(c),l=new d,u=new d,g={$:t=>b["$"+t],$$on:(t,e)=>r.on(t,e),$$once:(t,e)=>r.on(t,e,!0),$$off:(t,e)=>r.off(t,e),$$emit:(t,...e)=>r.emit(t,...e),$$map(t,n=c){if(o(b))return e(t)&&f(c,b,"#",t.bind(n)),b.map(t,n)}},b=new Proxy(t,{get:(t,o)=>o===h||(o in g?g[o]:(n(o)&&m.test(o)&&(e(t[o=o.slice(1)])||f(c,b,o)),Reflect.get(t,o))),set:(t,a,f)=>{if(n(a)&&m.test(a)){const t=a.slice(1)||"*";return e(f)&&r.on(t,f),!0}const d=i(t[a]);if(e(f)){f=p(c,b,a,f,u)}s(f)&&(f=$.call(c,f),w(b,a,f,l));const h=t[a]!==f||"length"===a&&o(t);if(!Reflect.set(t,a,f))return!1;if(h){const e=[a];o(t)&&isNaN(a)||e.push("*"),o(t)&&!isNaN(a)&&e.push("#"),r.emit(e,f,d,a,b)}return!0},deleteProperty:(t,e)=>{if(n(e)&&m.test(e)){const t=e.slice(1)||"*";return r.off(t),!0}const s=i(t[e]);if(!Reflect.deleteProperty(t,e))return!1;l.emit(e),u.emit(e);const c=[e];return o(t)&&isNaN(e)||c.push("*"),o(t)&&!isNaN(e)&&c.push("#"),r.emit(c,void 0,s,e,b),!0}});for(const o in t){if(e(t[o])){const e=t[o];if(n(o)&&m.test(o)){const n=o.slice(1)||"*";r.on(n,e),delete t[o]}else t[o]=p(c,b,o,e,u)}if(s(t[o])){const e=$.call(c,t[o]);t[o]=e,w(b,o,e,l)}}return b}function b(c,i){const{document:r,Node:l}=window,f=a(this);if(e(c)&&(c=c.call(f)),n(c))return r.createTextNode(c);if(!s(c))return c;if(o(c)){const t=r.createDocumentFragment();for(const e of c){const n=b.call(f,e,i);n instanceof l&&t.appendChild(n)}return t}const{tag:u,tagName:d="div",namespaceURI:h=i,shadowRootMode:m,classList:p,attributes:w,style:$,dataset:v,on:y,children:E,ref:N,...L}=c,C=function(t,e){const{document:o,customElements:s,Element:c}=window,i=[];let r,l,a="div";if(n(t))if(/[^a-zA-Z0-9-_.#]/u.test(t)){const e=o.createElement("div");e.innerHTML=t,e.firstChild instanceof c&&(r=e.firstChild,a=r.tagName)}else{const e=t.match(/([.#]?[^\s#.]+)/gu)||[];for(const t of e){const e=t[0];"."===e?i.push(t.slice(1)):"#"===e?l=t.slice(1):a=t}}else t instanceof c&&(r=t,a=r.tagName);if(!r){const t=s?.get(a);if(t)r=new t;else{if("http://www.w3.org/1999/xhtml"===e&&(e=null),!e)switch(`${a}`.toLowerCase()){case"svg":e="http://www.w3.org/2000/svg";break;case"math":e="http://www.w3.org/1998/Math/MathML"}r=e?o.createElementNS(e,a):o.createElement(a)}}return l&&(r.id=l),i.length&&(r.className=i.join(" ")),r}(u??d,h);i=C.namespaceURI,m&&C.attachShadow({mode:m});const A=[],M=(t,n)=>{if(e(t)){const e=g.call(f,t,n);A.push(e)}else n(t)};if(!t(y))for(const t in y){const n=y[t];e(n)&&C.addEventListener(t,(t=>n.call(f,t)))}const R=({children:t},e)=>{for(const n of t){const t=new CustomEvent(e,{cancelable:!0});n.dispatchEvent(t)}};C.addEventListener("mounted",(t=>{t.defaultPrevented||R(C,"mounted")})),C.addEventListener("removed",(t=>{if(!t.defaultPrevented){R(C,"removed");for(const t of A)t()}})),t(p)||M(p,(t=>{Array.isArray(t)?C.classList=t.join(" "):n(t)&&(C.classList=t)})),t(w)||M(w,(e=>{for(const n in e)M(e[n],(e=>{t(e)?C.removeAttribute(n):C.setAttribute(n,e)}))})),t($)||M($,(e=>{for(const n in e)M(e[n],(e=>{/[A-Z]/u.test(n)?t(e)?delete C.style[n]:C.style[n]=e:t(e)?C.style.removeProperty(n):C.style.setProperty(n,e)}))})),t(v)||M(v,(e=>{for(const n in e)M(e[n],(e=>{t(e)?delete C.dataset[n]:C.dataset[n]=e}))}));for(const e in L)M(L[e],(n=>{t(n)?delete C[e]:C[e]=n}));if(!t(E)){const t=m&&C.shadowRoot?C.shadowRoot:C;M(E,((e,n,o)=>{if("del"===o){const e=t.children[n];e&&t.removeChild(e)}else if("add"===o){const n=b.call(f,e,i);n&&t.appendChild(n)}else if("upd"===o){const o=t.children[n];if(o){const n=b.call(f,e,i);n&&t.replaceChild(n,o)}}else{t.innerHTML="";const n=b.call(f,e,i);n instanceof l&&t.appendChild(n)}}))}return e(N)&&N.call(f,C),C}function v(t,e,n){return o(t)?b.call(this,t):(s(t)&&(n=e,e=t,t=null),s(e)&&!o(e)||(n=e,e={}),b.call(this,{tag:t,children:n,...e}))}function y(t,e){const{MutationObserver:o,CustomEvent:s,Element:c,document:i}=window,{ELEMENT_NODE:r}=c,l=(t,e)=>{if(t.nodeType!==r)return;const n=new s(e,{cancelable:!0});t.dispatchEvent(n)};n(e)&&(e=i.querySelector(e));const a=new o((e=>{for(const n of e)if("childList"===n.type)n.addedNodes.forEach((t=>{l(t,"mounted")})),n.removedNodes.forEach((e=>{l(e,"removed"),e===t&&a.disconnect()}));else if("attributes"===n.type){const t=n.target,{attributeName:e}=n,{oldValue:o}=n,c=t.getAttribute(e);if(o!==c){const n=new s("changed",{detail:{attributeName:e,oldValue:o,newValue:c}});t.dispatchEvent(n)}}}));a.observe(e,{childList:!0,subtree:!0,attributeOldValue:!0}),e.appendChild(t)}function E(t,e){const{language:i=navigator.language,fallback:r="en"}=e||{};return(e,l,a=i)=>{n(l)&&(a=l,l=null),a&&t[a]||(a=r);let f=`${e}`.split(".").reduce(((t,e)=>s(t)?t[e]:""),t[a]);if(n(f))for(const t in l){const e=new RegExp(`%\\{${t}\\}`,"gu");let n=l[t];if(o(n)){const[t,e]=n;n=t,s(e)&&("number"==typeof t||c(t))&&(n=t.toLocaleString(a,e))}f=f.replace(e,n)}return f}}export{g as effect,E as l10n,y as mount,v as render,$ as signal};
