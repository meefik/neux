!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).neux={})}(this,(function(e){"use strict";function t(e){return void 0===e}function n(e){return"function"==typeof e}function o(e){return"string"==typeof e}function r(e){return Array.isArray(e)}function s(e){return"object"==typeof e&&null!==e&&(e.constructor===Object||e.constructor===Array)}function i(e){for(let t in e)return!1;return!0}const c=Symbol("context"),l={};function f(e){return s(e)?e:l}function a(e,t,n){const o=new Map,r=e[c];e[c]=o;const s=t();r?e[c]=r:delete e[c];for(let e of o){const[t,o]=e;for(let e in o)n(t,e)}return s}class u extends Map{constructor(e){super(),this._ctx=e}on(e,t){if(e&&t){const n=[].concat(e);for(let e of n)this.has(e)||this.set(e,new Map),this.get(e).set(t,!1)}}once(e,t){if(e&&t){const n=[].concat(e);for(let e of n)this.has(e)||this.set(e,new Map),this.get(e).set(t,!0)}}off(e,t){if(e){const n=[].concat(e);for(let e of n)this.has(e)&&(t?(this.get(e).delete(t),this.get(e).size||this.delete(e)):(this.get(e).clear(),this.delete(e)))}}emit(e,...t){if(e){const n=[].concat(e);for(let e of n)if(this.has(e))for(let[n,o]of this.get(e)){o&&this.off(e,n);try{n.apply(this._ctx,t)}catch(e){console.error(e)}}}}}const d=Symbol("signal");function h(e){let t=0;if(o(e))for(;e.startsWith("$");)e=e.slice(1),t++;return[t>0&&(e||(t>1?"*":"#")),e]}function m(e,t,n,o,r){return r.emit(n),a(e,o=o.bind(e,t,n),((e,s)=>{const i=()=>{t[n]=o()};e.$$on(s,i),r.once(n,(()=>e.$$off(s,i)))}))}function p(e,t,n,o){if(o.emit(t),n[d]){const r=(n,o,r,s,i=[])=>{e.$$emit("*",n,o,r,s,[...i,t])};n.$$on("*",r),o.once(t,(()=>n.$$off("*",r)))}}function g(e,t){const o=f(this),r=n(e)?e.bind(o):()=>e,s=t?t.bind(o):()=>{},i=new Set,c=a(o,r,((e,t)=>{let n;const o=()=>{clearTimeout(n),n=setTimeout((()=>s(r())),0)};e.$$on(t,o),i.add((()=>e.$$off(t,o)))}));if(s(c),i.size>0){return()=>{for(let e of i)e();i.clear()}}}function w(e,c){const{document:l,Node:a,CustomEvent:u}=window,d=f(this);if(n(e)&&(e=e.call(d)),o(e))return l.createTextNode(e);if(!s(e))return e;if(r(e)){const t=l.createDocumentFragment();for(let n of e){const e=w.call(d,n,c);e instanceof a&&t.appendChild(e)}return t}const{tag:h,tagName:m="div",namespaceURI:p=c,shadowRootMode:v,adoptedStyleSheets:b,on:E,ref:$,...N}=e,L=new Map,M=e=>{if(e){for(let t of L.keys())if(t.startsWith(e)){for(let e of L.get(t))e();L.delete(t)}}else{for(let e of L.values())for(let t of e)t();L.clear()}},A=(e,t)=>{L.has(e)?L.get(e).push(t):L.set(e,[t])},S=s(h)||n(h)?w.call(d,h,p):function(e,t){const{document:n,customElements:r,Element:s}=window,i=[];let c,l,f="div";if(o(e))if(/[^a-zA-Z0-9-_.#]/u.test(e)){const t=n.createElement("div");t.innerHTML=e,t.firstChild instanceof s&&(c=t.firstChild,f=c.tagName)}else{const t=e.match(/([.#]?[^\s#.]+)/gu)||[];for(let e of t){const t=e[0];"."===t?i.push(e.slice(1)):"#"===t?l=e.slice(1):f=e}}else e instanceof s&&(c=e,f=c.tagName);if(!c){const e=r?.get(f);if(e)c=new e;else{if("http://www.w3.org/1999/xhtml"===t&&(t=null),!t)switch(`${f}`.toLowerCase()){case"svg":t="http://www.w3.org/2000/svg";break;case"math":t="http://www.w3.org/1998/Math/MathML"}c=t?n.createElementNS(t,f):n.createElement(f)}}return l&&(c.id=l),i.length&&(c.className=i.join(" ")),c}(h||m,p);let x;if(c=S.namespaceURI,v&&(x=S.attachShadow({mode:v}),x&&b&&(x.adoptedStyleSheets=b)),!t(E))for(let e in E){const t=E[e];n(t)&&S.addEventListener(e,(e=>t.call(d,e)))}const T=({children:e},t)=>{for(let n of e){const e=new u(t,{cancelable:!0});n.dispatchEvent(e)}};S.addEventListener("mounted",(e=>{e.defaultPrevented||T(S,"mounted")})),S.addEventListener("removed",(e=>{e.defaultPrevented||(M(),T(S,"removed"))})),S.addEventListener("refresh",(e=>{if(!e.defaultPrevented)if(e.detail){const t=[].concat(e.detail);for(let e of t){const t=e.split("."),n=t.reduce(((e,n,o)=>e&&(o>=t.length-1?{[n]:e[n]}:e[n])),N);j(n,t.slice(0,-1))}}else j(N)}));const j=(e,n=[])=>{for(let r in e){const s=[...n,r],l=s.join("."),[f,h]=s,m=e[r];M(l);const p=g.call(d,m,(e=>{const n=h||o(h);if("children"===f){const t=x||S,n=w.call(d,e,c);if(n instanceof a){const e=Array.from(t[f]),o=n.nodeType===a.DOCUMENT_FRAGMENT_NODE;y(t,e,Array.from(o?n[f]:[n]))}else t.innerHTML="",M(l+".");e=n}else if("classList"===f)Array.isArray(e)?e=e.filter(Boolean).join(" "):o(e)||(e=""),S.className=e;else if("attributes"===f)if(h)n?S.setAttribute(h,e):S.removeAttribute(h);else{if(!i(e))return j(e,s);{const e=Object.keys(S[f]);for(let t of e)delete S[f][t].name;M(l+".")}}else if("style"===f)if(h)/[A-Z]/u.test(h)?n?S[f][h]=e:delete S[f][h]:n?S[f].setProperty(h,e):S[f].removeProperty(h);else{if(!i(e))return j(e,s);S.removeAttribute("style"),M(l+".")}else if("dataset"===f)if(h)n?S[f][h]=e:delete S[f][h];else{if(!i(e))return j(e,s);{const e=Object.keys(S[f]);for(let t of e)delete S[f][t];M(l+".")}}else{const{obj:n,key:o}=s.reduce(((e,n,o)=>o===s.length-1?{obj:e,key:n}:(t(e[n])&&(e[n]={}),e[n])),S);t(e)?(delete n[o],M(l+".")):n[o]=e}S.dispatchEvent(new u("updated",{detail:{property:l,value:e},cancelable:!0}))}));p&&A(l,p)}};return j(N),n($)&&$.call(d,S),S}function y(e,t,n){let o=0,r=0,s=t.length-1,i=n.length-1;for(;o<=s&&r<=i&&t[o].isEqualNode(n[r]);)o++,r++;for(;o<=s&&r<=i&&t[s].isEqualNode(n[i]);)s--,i--;if(o>s){const o=t[s+1]||null;for(;r<=i;)e.insertBefore(n[r++],o)}else if(r>i)for(;o<=s;)e.removeChild(t[o++]);else{const c=new Map;for(let e=o;e<=s;e++)c.set(t[e],e);for(;r<=i;){const t=n[r];let s=null;for(let[e]of c)if(e.isEqualNode(t)){s=e;break}const i=e.children[o];s?(e.insertBefore(s,i),c.delete(s)):e.insertBefore(t,i),r++,o++}for(let[t]of c)e.removeChild(t)}}e.effect=g,e.l10n=function(e,i){const{language:c=navigator.language,fallback:l="en"}=i||{},f=(t,n)=>{const o=e[n]||{};return t in o?o[t]:t.split(".").reduce(((e,t)=>s(e)?e[t]:""),o)};return(s,i,a=c)=>{if(o(i)&&(a=i,i=null),a&&e[a]||(a=l),o(s)){let e=f(s,a);return a!==l&&t(e)&&(e=f(s,l)),((e,t,s)=>{if(o(e))for(let o in t){const i=new RegExp(`%\\{${o}\\}`,"gu");let c=t[o];if(r(c)){const[e,t]=c;c=n(e?.toLocaleString)?e.toLocaleString(s,t):e}e=e.replace(i,c)}return e})(t(e)?s:e,i,a)}return n(s?.toLocaleString)?s.toLocaleString(a,i):s}},e.mount=function(e,t){const{MutationObserver:n,CustomEvent:r,Node:s,document:i}=window,c=(e,t)=>{if(e.nodeType!==s.ELEMENT_NODE)return;const n=new r(t,{cancelable:!0});e.dispatchEvent(n)};o(t)&&(t=i.querySelector(t));const l=new n((t=>{for(let n of t)if("childList"===n.type)n.addedNodes.forEach((e=>{e.parentNode&&c(e,"mounted")})),n.removedNodes.forEach((t=>{t.parentNode||c(t,"removed"),t===e&&l.disconnect()}));else if("attributes"===n.type){const e=n.target,{attributeName:t}=n,{oldValue:o}=n,s=e.getAttribute(t);if(o!==s){const n=new r("changed",{detail:{attributeName:t,oldValue:o,newValue:s}});e.dispatchEvent(n)}}}));l.observe(t,{childList:!0,subtree:!0,attributeOldValue:!0}),t.appendChild(e)},e.render=function(e,n,o){return r(e)?w.call(this,e):(s(e)&&(o=n,n=e,e=null),s(n)&&!r(n)||(o=n,n={}),t(o)||(n={children:o,...n}),w.call(this,{tag:e,...n}))},e.signal=function e(t={}){if(!s(t)||t[d])return t;const o=f(this),i=new u(o),l=new u,a=new u,g={$$on:(e,t)=>i.on(e,t),$$once:(e,t)=>i.once(e,t),$$off:(e,t)=>i.off(e,t),$$emit:(e,...t)=>i.emit(e,...t)},w={get:(e,t)=>{if(t===d)return!0;if(t in g)return g[t];const[n,r]=h(t);return n&&(function(e,t,n){const o=e[c];if(o){const e=o.get(t)||{};e[n]=!0,o.set(t,e)}}(o,y,n),!r)?y:Reflect.get(e,r)},set:(t,c,f)=>{const[u]=h(c);if(u)return!1;const d=t[c];if(n(f)){f=m(o,y,c,f,a)}s(f)&&(f=e.call(o,f),p(y,c,f,l));const g="length"===c&&r(t),w=t[c]!==f||g;return!!Reflect.set(t,c,f)&&(w&&i.emit(g?c:[c,"#","*"],f,d,c,y),!0)},deleteProperty:(e,t)=>{const[n]=h(t);if(n)return!1;const o=e[t];return!!Reflect.deleteProperty(e,t)&&(l.emit(t),a.emit(t),i.emit([t,"#","*"],void 0,o,t,y),!0)}},y=new Proxy(t,w),v=Object.keys(t);for(let r of v){const[i]=h(r);if(!i){if(n(t[r])){const e=t[r];t[r]=m(o,y,r,e,a)}if(s(t[r])){const n=e.call(o,t[r]);t[r]=n,p(y,r,n,l)}}}return y}}));
